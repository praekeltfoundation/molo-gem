{% extends "base.html" %}
{% load el_pagination_tags wagtailcore_tags core_tags wagtailimages_tags staticfiles gem_tags comments %}

{% block body_class %}default-container{% endblock %}

{% block content %}
<div class="search search-results">
  <div class="heading heading__component">
    <h1>{% trans "Search" %}</h1>
  </div>
{% if search_results %}
  <div class="heading heading__subheading">
    <h6>{{ results|length }} {% trans "results found for" %} "{{search_query}}".</h6>
  </div>
{% paginate 10 results as articles %}

{% include "patterns/components/article-teasers/sp_variations/base-teaser-listing.html" %}

  {% get_pages %}
  <div class="pagination">
    {% if pages.previous %}
      {% if pages.previous.number == 1 and pagelink == request.path %}
          <a href="/" class="pagination__nav-anchor-previous"></a>
      {% else %}
        <a href="{{ pagelink }}?page={{ pages.previous.number }}" class="pagination__nav-anchor-previous"></a>
      {% endif %}
    {% endif %}
    <span class="pagination__current-page">
      Page {{ pages.current }} of {{ pages|length }}
    </span>
    {% if pages.next %}
      <a href="{{ pagelink }}?page={{ pages.next.number }}" class="pagination__nav-anchor-next"></a>
    {% endif %}
  </div>
  <a id="more-link" href="#" data-next="{% url 'search_index' %}?page={{pages.next.number}}&q={{search_query}}&locale={{locale_code}}" class="more-link call-to-action__button call-to-action__button--primary">
    <span class="call-to-action__button-text call-to-action__button-text--primary">{% trans "Load more" %}</span>
  </a>
{% else %}
  <div class="heading heading__subheading">
    <h6>{% trans "No search results for " %}&quot;{{search_query}}&quot;.</h6>
  </div>

  {% trans "Search" as placeholdertext %}
  {% include "patterns/basics/search/sp_variations/search-button-icon.html" with radius="none" placeholder=placeholdertext %}

{% endif %}
{% get_tag_articles as tag_nav_data %}

{% include "patterns/components/article-teasers/sp_variations/carousel-teaser-listing.html" with tag=tag_nav_data.tags_list.0.0 tag_articles=tag_nav_data.tags_list.0.1 %}

  {% with tag_nav_data.tags_list.0.0 as tag %}
    {% if tag %}
    <div class="carousel-teaser">
      <div class="heading heading__component">
        <h2>{{tag.title}}</h2>
      </div>
      {% with tag_nav_data.tags_list.0.1 as tag_articles %}
        {% if tag_articles %}
        <ul class="carousel-teaser-list">
          {% for article in tag_articles %}
          <li class="carousel-teaser-list__item">
            <div class="carousel-teaser-list__item--container">
              {% if article.get_effective_image %}
              <a href="{% pageurl article.specific %}" class="carousel-teaser__thumbnail-link">
                {% image article.get_effective_image fill-218x96 as carousel_teaser_thumbnail %}
                <img alt="{{ article.title }}" src="{{ carousel_teaser_thumbnail.url }}" class="carousel-teaser__thumbnail" />
              </a>
              {% endif %}
              <div class="carousel-teaser__wrapper">
                <div class="carousel-teaser__content">
                  {% if page.title_highlight %}
                    <h3 class="carousel-teaser__title carousel-teaser__title--highlight">
                      <a href="{% pageurl article.specific %}" class="carousel-teaser__title-link">
                          {{ article.title_highlight|smarttruncatechars:45|safe}}
                      </a>
                    </h3>
                  {% else %}
                    <h3 class="carousel-teaser__title">
                      <a href="{% pageurl article.specific %}" class="carousel-teaser__title-link">
                          {{ article.title|smarttruncatechars:45|safe }}
                      </a>
                    </h3>
                  {% endif %}
                  {% if article.subtitle_highlight or article.body_highlight %}
                    <p class="carousel-teaser__subtitle highlight-description">
                      {% if article.subtitle_highlight %}
                        {{article.subtitle_highlight|smarttruncatechars:45|safe}}
                      {% elif article.body_highlight %}
                        {{article.body_highlight|smarttruncatechars:45|safe}}
                      {% endif %}
                    </p>
                  {% elif article.subtitle %}
                    <p class="carousel-teaser__subtitle">
                        {{ article.subtitle|smarttruncatechars:45|safe}}
                    </p>
                  {% endif %}
                  {% with layouttype="base" %}
                    {% get_comment_count for article as comment_count %}
                    {% if comment_count > 0 %}
                      <a href="{% pageurl article.specific %}?#comments" class="comment-counter">
                        <img alt="Comments" srcset="{% static 'img/icons/comment.svg' %}" src="{% static 'img/icons/check@2x.png' %}" class="comment-counter__icon">
                        <span class="comment-counter__numeral">{{comment_count}}</span>
                      </a>
                    {% endif %}
                  {% endwith %}
                </div>
              </div>
            </div>
          </li>
          {% endfor %}
        </ul>
        <div class="call-to-action">
          <a href="{% url 'tags_list' tag.slug %}" class="call-to-action__nav-item-text call-to-action__nav-item-text--right">
            {% trans "Read All" %} {{tag}}</a>
        </div>
        {% endif %}
      {% endwith %}
    </div>
    {% endif %}
  {% endwith %}


</div>
{% endblock %}

{% block search %}
  {% if search_results %}
      {% include "search/search_block.html" %}
  {% endif %}
{% endblock %}
