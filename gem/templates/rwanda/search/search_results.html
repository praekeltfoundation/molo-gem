{% extends "base.html" %}
{% load wagtailcore_tags core_tags wagtailimages_tags gem_tags comments %}

{% block content %}
  {% if search_results %}
  <div class="heading">
      <h1 class="heading__component">{% trans "Search" %}</h1>
      <p class="heading__micro">
        {{ search_results|length }} {% trans "results found for" %}:
        <strong>"{{search_query}}"</strong>
      </p>

  </div>
    {% include "search/search_block.html" %}
    <div class="article-teaser">
      <ul class="teaser-stacklist">
        {% for article in search_results %}
          <li class="teaser-stacklist__item">
            <div class="teaser-stacklist__wrapper">
              {% if article.image %}
                <div class="teaser-stacklist__thumbnail-wrap">
                  <a href="{% pageurl page.specific %}" class="article-teaser__link">
                    {% image article.image width-200 as teaser_thumbnail %}
                    <img src="{{ teaser_thumbnail.url }}" class="article-teaser__thumbnail" />
                  </a>
                </div>
              {% endif %}
              <div class="teaser-stacklist__content">
                <a href="{% pageurl article.specific %}" class="article-teaser__link">
                  {% if article.title_highlight %}
                    <h3 class="article-teaser__title article-teaser__title--highlight">
                      {{ article.title_highlight|smarttruncatechars:45|safe}}
                    </h3>
                  {% else %}
                    <h3 class="article-teaser__title">
                      {{ article.title|smarttruncatechars:45|safe}}
                    </h3>
                  {% endif %}
                </a>
                {% if article.subtitle_highlight or page.body_highlight %}
                  <p class="article-teaser__subtitle highlight-description">
                    {% if article.subtitle_highlight %}
                      {{page.subtitle_highlight|safe}}
                    {% elif article.body_highlight %}
                      {{article.body_highlight|safe}}
                    {% endif %}
                  </p>
                {% else %}
                    <p class="article-teaser__subtitle">
                      {% if next_article.title.30 %}
                        {{ next_article.subtitle|smarttruncatechars:28|safe}}
                      {% else %}
                        {{ next_article.subtitle|smarttruncatechars:40|safe}}
                      {% endif %}
                    </p>
                {% endif %}
                <a class="call-to-action__read-more" href="{% pageurl article.specific %}">
                  {% trans "Read more" %}
                </a>
                <ul class="teaser-stacklist-tags">
                  {% load_tags_for_article article as tags %}
                  {% if tags %}
                    {% for tag in tags %}
                    {% if not tag.title.20 %}
                      <li class="teaser-stacklist-tags__item">
                        <a href="{% url 'tags_list' tag.slug %}" class="teaser-stacklist-tags__anchor">
                          {{ tag.title }}
                        </a>
                      </li>
                      {% endif %}
                    {% endfor %}
                  {% endif %}
                  {% get_comment_count for article as comment_count %}
                  {% if comment_count > 0 %}
                  <li class="teaser-stacklist-tags__item">
                    <a href="{% pageurl article.specific %}?#comments" class="comment-counter">
                      <div class="comment-counter__icon"></div>
                      <span class="comment-counter__numeral">{{comment_count}}</span>
                    </a>
                    </li>
                  {% endif %}
                </ul>
              </div>
            </div>
          </li>
        {% endfor %}
      </ul>
    </div>


    <div class="search-result pagination">
      <div class="step-links">
        {% if search_results.has_previous %}
            <a href="?p={{ search_results.previous_page_number }}&amp;q={{search_query}}" class="pagination__nav-item pagination__nav-anchor-previous">&larr;</a>
        {% endif %}
        <span class="pagination__nav-item pagination__nav-item--current">
            Page {{ search_results.number }} of {{ search_results.paginator.num_pages }}
        </span>
        {% if search_results.has_next %}
            <a href="?p={{ search_results.next_page_number }}&amp;q={{search_query}}" class="pagination__nav-item pagination__nav-anchor-next">&rarr;</a>
        {% endif %}
      </div>
    </div>

    <!--PAGINATION-->
    {% if articles %}
      <div class="pagination">
      {% if articles_paginated.has_previous %}
        <a href="?p={{ articles_paginated.previous_page_number }}" class="pagination__nav-item pagination__nav-anchor-previous">&larr;</a>
      {% endif %}
        <span class="pagination__nav-item pagination__nav-item--current">
          Page {{ articles_paginated.number }} of {{ articles_paginated.paginator.num_pages }}
        </span>
      {% if articles_paginated.has_next %}
        <a href="?p={{ articles_paginated.next_page_number }}" class="pagination__nav-item pagination__nav-anchor-next">&rarr;</a>
      {% endif %}
      </div>
    {% endif %}

  {% else %}
    <div class="heading">
        <h1 class="heading__micro">{% trans "Search" %}</h1>
    </div>
    <div class="search">
      <p class="no-search-results">{% trans "No search results for " %} <br/> `{{ search_query }}`</p>
      <form action="{% url 'search' %}" class="search__form" novalidate>
        <input placeholder="{% trans "I am looking for" %}" name="q" type="search">
        <input type="submit" value="{% trans "Search"%}" class="call-to-action__item call-to-action__item--with-icon">
      </form>
    </div>
  {% endif %}
{% endblock %}
{% block search %}
  {% if search_results %}
      {% include "search/search_block.html" %}
  {% endif %}
{% endblock %}
