{% extends "base.html" %}
{% load el_pagination_tags wagtailcore_tags core_tags wagtailimages_tags gem_tags comments %}

{% block content %}
<div class="search search-page">
{% if search_results %}

  <div class="heading heading--hero">
    <h1 class="heading__component">{% trans "Search" %}</h1>
  </div>

  <h3 class="heading__micro">{{results|length}} {% trans "results found for" %}:
    <span class="search__query-term">'{{search_query}}'</span>
  </h3>
  {% comment %}{% include "search/search_block.html" %}{% endcomment %}
  <div class="article-teaser">
    <ul class="teaser-stacklist">
    {% for article in search_results %}
      <li class="teaser-stacklist__item">
        {% if article.image %}
          <div class="teaser-stacklist__images">
            {% image article.image width-200 as teaser_thumbnail %}
            <img src="{{ teaser_thumbnail.url }}" class="article-teaser__thumbnail" />
          </div>
        {% endif %}
        <ul class="teaser-stacklist-tags">
          {% get_comment_count for article as comment_count %}
          {% if comment_count > 0 %}
          <li class="teaser-stacklist-tags__item">
            <a href="{% pageurl article.specific %}?#comments" class="comments-counter">
              <div class="comments-counter__icon"></div>
              <span class="comments-counter__numeral">{{comment_count}}</span>
            </a>
            </li>
          {% endif %}
          {% load_tags_for_article article as tags %}
          {% if settings.core.SiteSettings.enable_tag_navigation and tags %}
            {% for tag in tags %}
            {% if not tag.title.20 %}
              <li class="teaser-stacklist-tags__item">
                <a href="{% url 'tags_list' tag.slug %}" class="teaser-stacklist-tags__anchor">
                  {{ tag.title }}
                </a>
              </li>
              {% endif %}
            {% endfor %}
          {% endif %}
        </ul>
        <h3 class="article-teaser__title {% if article.title_highlight %}article-teaser__title--highlight{% endif %}">
          {% if article.title_highlight %}
            {{ article.title_highlight|smarttruncatechars:23|safe}}
          {% else %}
            {{ article.title|safe}}
          {% endif %}
        </h3>
        {% if article.subtitle_highlight or page.body_highlight %}
          <p class="article-teaser__subtitle">
            {% if article.subtitle_highlight %}
              {{page.subtitle_highlight|safe}}
            {% elif article.body_highlight %}
              {{article.body_highlight|safe}}
            {% endif %}
          </p>
        {% else %}
          <p class="article-teaser__subtitle">
            {% if article.title.30 %}
              {{ article.subtitle|smarttruncatechars:30|safe}}
            {% else %}
              {{ article.subtitle|smarttruncatechars:50|safe}}
            {% endif %}
          </p>
        {% endif %}
        <a href="{% pageurl article.specific %}" class="call-to-action__button call-to-action__button--primary">
          {% trans "Read more" %}</a>
      </li>
    {% endfor %}
    </ul>
  </div>
  {% if search_results.paginator.num_pages > 1 %}
    <div class="pagination">
      {% if search_results.has_previous %}
        <a href="?p={{ search_results.previous_page_number }}&amp;q={{search_query}}" class="call-to-action__button call-to-action__button--secondary">{% trans "Previous" %}</a>
      {% endif %}
      <p class="call-to-action__item--text call-to-action__item--text-current">
        {% trans "Page" %} {{ search_results.number }} {% trans "of" %} {{ search_results.paginator.num_pages }}</p>
      {% if search_results.has_next %}
        <a href="?p={{ search_results.next_page_number }}&amp;q={{search_query}}" class="call-to-action__button call-to-action__button--secondary">{% trans "Newer</a>
      {% endif %}
    </div>
  {% endif %}
</div>
{% else %}
  <div class="search">
    <div class="heading heading--hero">
      <h1 class="heading__component">{% trans "Search" %}</h1>
    </div>
    <h4 class="heading__micro">{% trans "No search results for" %}:
      <span class="search__query-term">'{{ search_query }}'</span>
    </h4>
    <form action="{% url 'search' %}" class="search__form" novalidate>
      <input name="q" type="search" aria-label="Search Input" placeholder="{% trans "I am looking for" %}">
      <input type="submit" value="{% trans "Search" %}" class="call-to-action__item call-to-action__item--text">
    </form>
  </div>
{% endif %}
{% endblock %}
